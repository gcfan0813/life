# 迁移计划：从简化版到完整版后端

## 当前状态（2026-02-12）

### 简化版后端 (simple_server.py)
**优点：**
- ✅ 稳定可用，无导入问题
- ✅ 独立实现，启动简单
- ✅ 适合快速原型开发

**缺点：**
- ❌ 绕过核心引擎，无规则校验
- ❌ AI推演功能缺失
- ❌ 无学术依据支持
- ❌ 事件质量低下
- ❌ 无法支持500+规则库

### 完整版后端 (main.py - 已删除)
**优点：**
- ✅ 集成核心引擎
- ✅ 支持500+学术验证规则
- ✅ AI推演+规则约束混合引擎
- ✅ 五维系统完整耦合
- ✅ 事件生成质量高

**缺点：**
- ❌ Python导入路径问题
- ❌ 启动失败
- ❌ 开发阶段不可用

## 迁移策略

### 阶段1：修复完整版导入问题（立即执行）

**目标：** 修复main.py的Python路径问题，使其能够启动

**任务：**
- [ ] 分析导入错误原因
- [ ] 修复sys.path配置
- [ ] 测试核心模块导入
- [ ] 验证基本功能

**预期时间：** 2-3小时

### 阶段2：功能对比和映射（1-2天）

**目标：** 确保simple_server.py的所有功能在main.py中都有对应实现

**任务：**
- [ ] 对比两个文件的API接口
- [ ] 映射simple_server.py的事件生成到核心引擎
- [ ] 确保数据库兼容性
- [ ] 测试每个API端点

### 阶段3：渐进式迁移（1周）

**目标：** 在不破坏现有功能的前提下，逐步集成核心引擎功能

**任务：**
- [ ] 使用main.py框架，但暂时使用simple_server.py的事件生成逻辑
- [ ] 集成规则校验引擎（轻度使用）
- [ ] 添加日志系统，对比两个版本的输出差异
- [ ] 前端无缝切换

### 阶段4：完全切换（1-2周）

**目标：** 完全使用核心引擎，停用simple_server.py的逻辑

**任务：**
- [ ] 移除simple_server.py中的硬编码事件生成
- [ ] 完全集成AI生成器
- [ ] 启用500+规则库
- [ ] 性能优化和测试

## 风险评估

### 高风险
- **规则引擎集成**：可能导致事件生成变慢
- **AI API调用**：需要处理网络失败和降级
- **数据兼容性**：确保迁移过程中用户数据不丢失

### 中风险
- **前端适配**：API响应格式可能变化
- **性能下降**：完整版可能比简化版慢
- **调试复杂度**：增加

### 低风险
- **用户体验**：无明显变化
- **部署复杂度**：保持不变

## 回滚方案

**如果在迁移过程中出现问题：**

1. **立即回滚：** 使用Git恢复到使用simple_server.py的版本
2. **并行运行：** 同时维护两个版本，通过配置切换
3. **功能开关：** 添加feature flag，逐步启用完整版功能

## 时间规划

| 阶段 | 时间 | 里程碑 |
|------|------|--------|
| 阶段1：修复导入 | 2-3小时 | main.py可以启动 |
| 阶段2：功能映射 | 1-2天 | 功能对比完成 |
| 阶段3：渐进迁移 | 1周 | 混合模式运行 |
| 阶段4：完全切换 | 1-2周 | 停用simple_server.py逻辑 |
| **总计** | **3-4周** | 完整迁移完成 |

## 当前建议

### 立即行动：
1. **保留simple_server.py**作为稳定版本
2. **创建新分支**进行迁移开发
3. **修复main.py导入问题**（最高优先级）

### 短期（本周）：
1. 完成main.py修复
2. 确保基本功能可用
3. 开始功能对比

### 中期（本月）：
1. 渐进式集成核心引擎
2. 添加规则校验（轻度）
3. 性能测试

### 长期（下月）：
1. 完全切换
2. 启用完整规则库
3. 优化AI调用

## 结论

**您的担忧完全正确！** 继续使用simple_server.py确实会造成项目缺陷。

**建议：** 立即开始迁移计划，优先修复main.py的导入问题，确保项目能够使用完整的AI推演+规则约束混合引擎，这是《无限人生》的核心价值所在。

**权衡：** simple_server.py可以作为降级方案保留，在网络失败或AI服务不可用时使用。
