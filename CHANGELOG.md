# 开发变更日志

## [2026-02-12] - 前后端集成完成日

### ✅ 新增功能

#### 前端开发
- **完整的角色创建界面** - 3步骤表单（基本信息、初始条件、个性特征）
- **时间轴主界面** - 事件卡片、播放控制、状态面板
- **导航栏组件** - 角色信息、系统状态、页面切换
- **状态管理集成** - Zustand + API服务层
- **可视化组件** - 进度条、滑动条、按钮交互
- **API服务层** - 统一的HTTP客户端，支持错误处理和重试
- **前后端数据交互** - 完整的API调用链（创建角色→推进时间→处理决策）

#### 后端开发（FastAPI服务 - 端口8001）
- **FastAPI服务** - 基于FastAPI的完整RESTful API
- **数据库管理** - SQLite自动初始化和连接（profiles和events表）
- **完整API接口**：
  - `POST /api/profiles` - 创建角色档案
  - `GET /api/profiles` - 获取角色列表
  - `POST /api/profiles/{id}/advance` - 推进时间并生成事件
  - `POST /api/profiles/{id}/decisions` - 处理用户决策
  - `GET /api/events/{id}` - 获取角色事件
  - `GET /api/data/exists` - 检查数据是否存在
  - `GET /api/health` - 健康检查
- **CORS支持** - 跨域访问配置
- **事件生成逻辑** - 随机生成工作、健康、社交等类型事件
- **决策处理** - 记录用户选择并标记事件完成
- **独立实现** - 不依赖核心引擎模块，稳定可用

#### 文档完善
- **API文档** - 完整的接口说明、请求/响应格式、使用示例
- **FAQ更新** - 常见问题解答（数据重置、错误处理、调试技巧）
- **系统状态** - 服务地址、功能列表、测试账号

#### 服务层
- **API服务类** - 统一的前后端通信接口
- **本地服务模拟** - 离线模式下的回退方案
- **错误处理** - 网络失败自动切换到本地服务
- **类型安全** - TypeScript类型定义

### 🔧 技术改进

#### 构建系统
- 修复Vite配置错误（移除不存在的Python模块引用）
- 添加index.html入口文件
- 优化依赖预构建配置

#### 开发环境
- 解决PowerShell执行策略问题
- 配置前后端开发服务器（前端3002，后端8001）
- 实现热重载和自动刷新
- **代码清理** - 删除重复的backend/main.py，统一使用simple_server.py
- **统一API端口** - 统一使用8001端口，避免混淆

### 📚 文档更新

- 更新README.md - 添加快速开始指南和常见问题
- 更新to-do.md - 标记已完成任务，添加开发进度记录
- 创建CHANGELOG.md - 记录本次开发变更
- 更新CODEBUDDY.md - 添加后端服务说明

### 🐛 问题修复

- 修复前端卡在加载页面的问题（添加initialize()调用）
- 修复Vite构建错误（移除@core/ai和@shared/ai引用）
- 修复后端服务启动失败问题（创建简化版服务）
- **修复代码重复问题** - 删除backend/main.py，统一使用simple_server.py

### ⚠️ 已知问题

- **简化版API功能缺陷** - 绕过了核心引擎，无500+规则、无AI推演
- **学术可信度不足** - 事件生成缺乏科学依据
- **建议迁移到完整版** - 详见MIGRATION_PLAN.md
- **修复代码重复问题** - 删除backend/main.py，统一使用simple_server.py

### 🎯 下一步计划

#### 高优先级
- [x] 完善后端API接口（推进时间、事件处理）✅ 已完成
- [x] 实现前端与后端的真实数据交互 ✅ 已完成
- [x] API文档完善 ✅ 已完成
- [ ] 测试完整的人生推演流程 - 验证数据流和交互逻辑
- [ ] 修复前端事件显示问题 - 确保事件正确渲染
- [ ] 实现决策效果应用 - 选择影响角色状态

#### 中优先级
- [ ] 开发未来预览功能
- [ ] 规则库扩展和优化
- [ ] 性能优化：70年存档加载 < 3秒

#### 低优先级
- [ ] 移动端适配
- [ ] AI模型分层集成（L0-L3）
- [ ] 因果链追溯基础

---

## 系统运行状态

### 服务地址
- **前端应用**：http://localhost:3002/
- **后端API**：http://localhost:8001/
- **API文档**：http://localhost:8001/docs

### 测试账号
可以使用以下测试数据：
- 姓名：测试用户
- 出生日期：2000-01-01
- 出生地点：北京
- 性别：男/女

### 功能验证清单
- [x] 前端启动成功
- [x] 后端启动成功
- [x] 角色创建界面显示
- [x] 表单输入和验证
- [x] 时间轴界面显示
- [x] 状态面板显示
- [x] 导航栏显示
- [x] 前后端通信
- [x] 后端API接口完善
- [x] 前端API服务层实现
- [x] API文档编写
- [ ] 完整流程测试（创建角色→推进时间→处理事件）

---

*文档版本：v1.0*  
*最后更新：2026-02-12*
